<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Production Buildings • HayDay Progress Tracker</title>
  <link rel="stylesheet" href="assets/styles.css" />
  <style>
    .name-cell{font-weight:600}
    .center{text-align:center}
    .chk-wrap{display:inline-flex; align-items:center; gap:6px}
    .chk-wrap input[type="checkbox"]{transform:scale(1.2)}
  </style>
</head>
<body class="hd-body">
  <header class="hd-header">
    <div class="brand">
      <span class="logo">H</span>
      <h1>Production Buildings</h1>
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="production.html" class="active">Production Buildings</a>
      <a href="animals.html">Animals</a>
      <a href="crops.html">Crops</a>
    </nav>
  </header>

  <main class="container">
    <section class="card">
      <div class="table-wrap">
        <table class="hd-table" id="prod-table" aria-label="Production Buildings Progress">
          <thead>
            <tr>
              <th style="width:40%">Building</th>
              <th>Unlocked</th>
              <th>Level 2</th>
              <th>Level 3</th>
              <th>Level 4</th>
            </tr>
          </thead>

          <tbody id="prod-body">
            <!-- 55 filas estáticas -->
            <tr><td class="name-cell">Bakery</td>               <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Feed mill</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Feed mill</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Dairy</td>                <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Sugar mill</td>           <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Sugar mill</td>           <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Popcorn pot</td>          <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">BBQ grill</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Pie oven</td>             <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Loom</td>                 <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Sewing machine</td>       <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Cake oven</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Smelter</td>              <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Smelter</td>              <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Smelter</td>              <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Smelter</td>              <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Smelter</td>              <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Juice press</td>          <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Ice cream maker</td>      <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Jam maker</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Jeweler</td>              <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Honey extractor</td>      <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Coffee kiosk</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Soup kitchen</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Candle maker</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Flower shop</td>          <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Candy machine</td>        <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Sauce maker</td>          <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Sushi bar</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Salad bar</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Sandwich bar</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Smoothie mixer</td>       <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Pasta maker</td>          <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Essential oils lab</td>   <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Wok kitchen</td>          <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Hat maker</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Pasta kitchen</td>        <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Hot dog stand</td>        <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Donut maker</td>          <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Taco kitchen</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Omelet Station</td>       <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Tea stand</td>            <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Fondue pot</td>           <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Bath kiosk</td>           <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Deep fryer</td>           <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Preservation station</td> <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Pottery Studio</td>       <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Fudge shop</td>           <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Yogurt maker</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Stew pot</td>             <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Cupcake maker</td>        <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Perfumerie</td>           <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Waffle Maker</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Porridge Bar</td>         <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
            <tr><td class="name-cell">Milkshake Bar</td>        <td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td><td class="center"><input type="checkbox" class="chk"></td></tr>
          </tbody>

          <tfoot>
            <tr>
              <td class="align-right"><strong>Section Progress</strong></td>
              <td colspan="4">
                <div class="progress">
                  <div id="section-bar" class="progress-bar" style="width:0%"></div>
                </div>
                <div class="progress-note"><span id="section-label">—</span></div>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </section>
  </main>

  <footer class="hd-footer">
    <small>Saved to your browser automatically • v0.1</small>
  </footer>

  <!-- JS mínimo: sin construir filas; solo carga/guarda y progreso -->
  <script src="assets/app.js?v=static"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.getElementById("prod-body");
      const sectionBar = document.getElementById("section-bar");
      const sectionLabel = document.getElementById("section-label");

      function collectRowsFromDOM() {
        const rows = [];
        tbody.querySelectorAll("tr").forEach(tr => {
          const name = tr.querySelector(".name-cell")?.textContent?.trim() ?? "";
          const checks = tr.querySelectorAll("input.chk");
          rows.push({
            name,
            levels: Array.from(checks, cb => cb.checked ? 1 : 0),
          });
        });
        return rows;
      }

      function applyRowsToDOM(rows) {
        const trs = tbody.querySelectorAll("tr");
        trs.forEach((tr, i) => {
          const checks = tr.querySelectorAll("input.chk");
          const levels = rows?.[i]?.levels || [];
          checks.forEach((cb, j) => cb.checked = !!levels[j]);
        });
      }

      function save() {
        const state = HD.loadAll();
        state.production = { rows: collectRowsFromDOM(), updatedAt: new Date().toISOString() };
        HD.saveAll(state);
      }

      function renderProgress() {
        const rows = collectRowsFromDOM();
        // Cálculo inline: promedio de (checks marcados / checks totales) por fila
        const vals = rows.map(r => {
          const total = r.levels.length || 0;
          if (!total) return null;
          const sum = r.levels.reduce((a,b) => a + (b ? 1 : 0), 0);
          return sum / total;
        }).filter(v => v !== null);
        const pct = vals.length ? vals.reduce((a,b)=>a+b,0)/vals.length : 0;

        sectionLabel.textContent = HD.formatPct(pct);
        sectionBar.style.width = (pct*100).toFixed(2) + "%";
      }

      // Eventos
      tbody.addEventListener("change", (e) => {
        if (e.target.matches("input.chk")) {
          save();
          renderProgress();
        }
      });

      // INIT: cargar desde storage si existe
      const saved = HD.loadAll()?.production?.rows;
      if (Array.isArray(saved) && saved.length) {
        applyRowsToDOM(saved);
      }
      renderProgress();
    });
  </script>
</body>
</html>
